# LangSAM ROS2 システム統合設定ファイル
# 技術的目的: ゼロショット物体検出、リアルタイム追跡、セグメンテーションの統合システム構築
lang_sam_tracker_node:
  ros__parameters:
    # ===== AIモデル設定 =====
    # 目的: GroundingDINO/SAM2モデルの選択と闾値設定で精度を制御
    sam_model: "sam2.1_hiera_small"  # SAM2モデル（tiny/small/base/large）
    text_prompt: "white line. road."  # GroundingDINO検出プロンプト
    # 目的: 自然言語で物体を指定してゼロショット検出を実現
    box_threshold: 0.3  # GroundingDINO BoundingBox信頼度閾値
    text_threshold: 0.25  # GroundingDINO テキスト類似度閾値
    tracking_targets: ["white line", "red pylon", "human", "car"]  # 今後実装予定
    
    # ===== 実行周波数設定 =====
    # 目的: GPUメモリ使用量とリアルタイム性のバランス最適化
    gdino_interval_seconds: 1.5  # GroundingDINO実行間隔（2.0秒 = 0.5Hz）
    sam2_interval_seconds: 0.1   # SAM2セグメンテーション実行間隔（0.1秒 = 10Hz）
    sam2_independent_mode: true  # SAM2独立実行モード（SORTトラッキング結果を使用）
    
    # ===== ROS2トピック設定 =====
    # 目的: モジュラーシステム構築で各コンポーネントを分離
    # input_topic: "/image_raw"  # 入力画像（simulator）
    input_topic: "/zed/zed_node/rgb/image_rect_color"  # 入力画像（ZEDカメラ）
    gdino_topic: "/image_gdino"    # GroundingDINO検出結果配信
    optical_flow_output_topic: "/image_optical_flow"      # OpticalFlow追跡結果配信
    sam_topic: "/image_sam"        # SAM2セグメンテーション結果配信
    
    # ===== OpticalFlowトラッカーパラメータ =====
    # 技術的目的: goodFeaturesToTrack + calcOpticalFlowPyrLKによる特徴点ベース追跡
    
    # 特徴点検出パラメータ（増やすと精度向上、処理負荷増加）
    optical_flow_max_corners: 100         # 抽出する最大特徴点数（50-200推奨）
    optical_flow_quality_level: 0.01      # 特徴点の品質レベル閾値（0.001-0.1、小さいほど多くの点を検出）
    optical_flow_min_distance: 10         # 特徴点間の最小距離（5-30ピクセル、密集度制御）
    optical_flow_block_size: 7            # 特徴点検出のブロックサイズ（3-21の奇数、大きいほど安定）
    
    # OpticalFlow追跡パラメータ（大きいほど大きな動きに対応、処理負荷増加）
    optical_flow_win_size_x: 31           # Optical Flow探索ウィンドウX（5-31の奇数、動き量に応じて調整）
    optical_flow_win_size_y: 31           # Optical Flow探索ウィンドウY（5-31の奇数、動き量に応じて調整）
    optical_flow_max_level: 3             # ピラミッドレベル数（0-5、大きな動きには3-4推奨）
    
    # トラック管理パラメータ
    optical_flow_max_disappeared: 60      # トラック削除までの最大未検出フレーム数（10-60）
    optical_flow_min_tracked_points: 3    # トラック維持に必要な最小特徴点数（3-10、安定性重視）

lane_following_node:
  ros__parameters:
    # ===== 制御パラメータ =====
    linear_velocity: 1.0           # 前進速度（m/s）
    kp: 1.0                        # P制御ゲイン（比例制御のみ使用）
    max_angular_velocity: 1.0      # 最大角速度（rad/s）
    original_image_topic: "/zed/zed_node/rgb/image_rect_color"  # 元画像トピック

    # ===== スムージングパラメータ =====
    # 目的: 連続的で滑らかな制御を実現する目的でスムージング機能を提供
    smoothing_alpha: 0.3           # 指数移動平均の係数（0.1-0.5推奨、小さいほど滑らか）
    use_smoothing: true            # スムージング有効化フラグ
    use_prediction: true           # 検出失敗時の予測制御有効化フラグ
    max_prediction_frames: 10      # 検出失敗時の最大予測継続フレーム数（3-15推奨）

    # ===== 可視化パラメータ =====
    enable_visualization: true     # 可視化有効化フラグ
    line_thickness: 3              # 線の太さ（pixel）
    circle_radius: 10              # 円の半径（pixel）

multi_view_node:
  ros__parameters:
    # ===== 4分割画像配置設定 =====
    upper_left_topic: "/image_gdino"  # 左上の画像トピック
    upper_right_topic: "/image_optical_flow"    # 右上の画像トピック
    lower_left_topic: "/image_sam"      # 左下の画像トピック
    lower_right_topic: "/lane_following_visualization"      # 右下の画像トピック
    
    # ===== 4分割画像出力設定 =====
    output_fps: 30.0               # 統合画像配信周波数（Hz）
    output_width: 1280             # 統合画像幅（ピクセル）
    output_height: 720             # 統合画像高さ（ピクセル）
    border_width: 2                # 分割境界線幅（ピクセル）
    border_color: [255, 255, 255]  # 境界線色（BGR: 白）
    
    # ===== 周波数表示ラベル設定 =====
    enable_labels: true            # ラベル表示有効化
    label_font_scale: 1.0          # OpenCVフォントスケール
    label_thickness: 2             # テキスト線太さ
    label_color: [0, 255, 0]       # ラベル色（BGR: 緑）